<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[YggdrasillNetwork Blog]]></title>
  <link href="http://ryoogata.github.io/atom.xml" rel="self"/>
  <link href="http://ryoogata.github.io/"/>
  <updated>2014-10-17T13:54:33+09:00</updated>
  <id>http://ryoogata.github.io/</id>
  <author>
    <name><![CDATA[Ryo Ogata]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Vagrant の Provisioner に Chef Client を利用する際に遭遇したトラブルとその解決策]]></title>
    <link href="http://ryoogata.github.io/blog/vagrant/vagrant/"/>
    <updated>2014-10-16T16:41:05+09:00</updated>
    <id>http://ryoogata.github.io/blog/vagrant/vagrant</id>
    <content type="html"><![CDATA[<h1>概要</h1>

<p>Vagrant の Provisioner に Chef Client を利用する際に遭遇したトラブルとその解決策</p>

<h2>chef is not part of the bundle エラー</h2>

<h3>内容</h3>

<p>下記の設定がされている状態で、vagrant destory を実行すると VM は削除されるが、chef server 上の Nodes/Clients から情報が削除されない。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chef.node_name = "vagrant-win7"
</span><span class='line'>chef.delete_node = true</span></code></pre></td></tr></table></div></figure>


<p><code>chef is not part of the bundle. Add it to Gemfile. (Gem::LoadError)</code> のエラーを吐いて処理が終了してしまう。</p>

<h3>エラーログ</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant destroy -f
</span><span class='line'>WARNING: Could not load IOV methods. Check your GSSAPI C library for an update
</span><span class='line'>WARNING: Could not load AEAD methods. Check your GSSAPI C library for an update
</span><span class='line'>==&gt; default: Forcing shutdown of VM...
</span><span class='line'>==&gt; default: Destroying VM and associated drives...
</span><span class='line'>==&gt; default: Running cleanup tasks for 'chef_client' provisioner...
</span><span class='line'>==&gt; default: Deleting client "vagrant-win7.example.local" from Chef server...
</span><span class='line'>==&gt; default: Cleaning up the 'client' for Chef failed. The stdout and
</span><span class='line'>==&gt; default: stderr are shown below. Vagrant will continue destroying the machine,
</span><span class='line'>==&gt; default: so please clean up these resources manually.
</span><span class='line'>==&gt; default: 
</span><span class='line'>==&gt; default: stdout: 
</span><span class='line'>==&gt; default: 
</span><span class='line'>==&gt; default: stderr: /Applications/Vagrant/embedded/gems/gems/bundler-1.6.2/lib/bundler/rubygems_integration.rb:252:in `block in replace_gem': chef is not part of the bundle. Add it to Gemfile. (Gem::LoadError)
</span><span class='line'>==&gt; default:   from /Users/ryo/.rvm/gems/ruby-2.0.0-p451@railstutorial_rails_4_0/bin/knife:22:in `&lt;main&gt;'
</span><span class='line'>==&gt; default:   from /Users/ryo/.rvm/gems/ruby-2.0.0-p451@railstutorial_rails_4_0/bin/ruby_executable_hooks:15:in `eval'
</span><span class='line'>==&gt; default:   from /Users/ryo/.rvm/gems/ruby-2.0.0-p451@railstutorial_rails_4_0/bin/ruby_executable_hooks:15:in `&lt;main&gt;'
</span><span class='line'>==&gt; default: Deleting node "vagrant-win7.example.local" from Chef server...
</span><span class='line'>==&gt; default: Cleaning up the 'node' for Chef failed. The stdout and
</span><span class='line'>==&gt; default: stderr are shown below. Vagrant will continue destroying the machine,
</span><span class='line'>==&gt; default: so please clean up these resources manually.
</span><span class='line'>==&gt; default: 
</span><span class='line'>==&gt; default: stdout: 
</span><span class='line'>==&gt; default: 
</span><span class='line'>==&gt; default: stderr: /Applications/Vagrant/embedded/gems/gems/bundler-1.6.2/lib/bundler/rubygems_integration.rb:252:in `block in replace_gem': chef is not part of the bundle. Add it to Gemfile. (Gem::LoadError)
</span><span class='line'>==&gt; default:   from /Users/ryo/.rvm/gems/ruby-2.0.0-p451@railstutorial_rails_4_0/bin/knife:22:in `&lt;main&gt;'
</span><span class='line'>==&gt; default:   from /Users/ryo/.rvm/gems/ruby-2.0.0-p451@railstutorial_rails_4_0/bin/ruby_executable_hooks:15:in `eval'
</span><span class='line'>==&gt; default:   from /Users/ryo/.rvm/gems/ruby-2.0.0-p451@railstutorial_rails_4_0/bin/ruby_executable_hooks:15:in `&lt;main&gt;'</span></code></pre></td></tr></table></div></figure>


<h3>対応策</h3>

<p>Vagrant の Version を 1.6.5 に上げる</p>

<p>Vagrant 1.6.3 だとエラーが出るが、 1.6.5 だとエラーが出ず、Chef Server 上から Nodes/Clients から情報が削除される。</p>

<h2>NameError</h2>

<h3>内容</h3>

<p>下記の設定がされている状態で、vagrant destory を実行すると VM は削除されるが、chef server 上の Nodes/Clients から情報が削除されない。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chef.delete_node = true</span></code></pre></td></tr></table></div></figure>


<p><code>uninitialized constant Berkshelf::BerkshelfError (NameError)</code> のエラーを吐いて処理が終了してしまう。</p>

<h3>エラーログ</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant destroy -f
</span><span class='line'>
</span><span class='line'>WARNING: Could not load IOV methods. Check your GSSAPI C library for an update
</span><span class='line'>WARNING: Could not load AEAD methods. Check your GSSAPI C library for an update
</span><span class='line'>==&gt; default: Forcing shutdown of VM...
</span><span class='line'>==&gt; default: Destroying VM and associated drives...
</span><span class='line'>==&gt; default: Running cleanup tasks for 'chef_client' provisioner...
</span><span class='line'>==&gt; default: Deleting client "" from Chef server...
</span><span class='line'>/Users/ryo/.vagrant.d/gems/gems/vagrant-berkshelf-3.0.1/lib/berkshelf/vagrant/action/clean.rb:21:in `rescue in call': uninitialized constant Berkshelf::BerkshelfError (NameError)</span></code></pre></td></tr></table></div></figure>


<h3>対応策</h3>

<p>Chef Server 上のどの Node を削除するのか指定できないので、エラーで止まるみたい。</p>

<p>Vagrantfile に下記の記述を追加して対応</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chef.node_name = "vagrant-win7"</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Chef Chef-Server]]></title>
    <link href="http://ryoogata.github.io/blog/chef/chef-chef-server/"/>
    <updated>2014-10-16T16:41:05+09:00</updated>
    <id>http://ryoogata.github.io/blog/chef/chef-chef-server</id>
    <content type="html"><![CDATA[<p>test</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopress 入門してみた]]></title>
    <link href="http://ryoogata.github.io/blog/octopress/octopress/"/>
    <updated>2014-10-16T12:20:15+09:00</updated>
    <id>http://ryoogata.github.io/blog/octopress/octopress</id>
    <content type="html"><![CDATA[<h1>概要</h1>

<p>Octopress を使って Blog を公開してみようと思い立ってから、あれこれ調べたこと。</p>

<h2>参照 URL</h2>

<ul>
<li><a href="http://www.slideshare.net/yizawa/octopress">Octpress簡単スタートガイド</a></li>
</ul>


<h1>Octopress セットアップ</h1>

<h2>Octopress を持ってくる</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone git://github.com/imathis/octopress.git octopress</span></code></pre></td></tr></table></div></figure>


<h2>bundler の実行</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ bundle install --path vendor/bundle --binstubs vendor/binstubs</span></code></pre></td></tr></table></div></figure>


<h2>Default テーマの設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake install</span></code></pre></td></tr></table></div></figure>


<h2>static サイトの生成</h2>

<h3>サイトの生成</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate</span></code></pre></td></tr></table></div></figure>


<h3>Preview の表示</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake preview</span></code></pre></td></tr></table></div></figure>


<h2>手元の octpress Directory と github の master ブランチを連携させる</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake setup_github_pages
</span><span class='line'>Enter the read/write url for your repository
</span><span class='line'>(For example, 'git@github.com:your_username/your_username.github.io.git)
</span><span class='line'>           or 'https://github.com/your_username/your_username.github.io')
</span><span class='line'>Repository url: https://github.com/ryoogata/ryoogata.github.io.git
</span><span class='line'>Added remote https://github.com/ryoogata/ryoogata.github.io.git as origin
</span><span class='line'>Set origin as default remote
</span><span class='line'>Master branch renamed to 'source' for committing your blog source files
</span><span class='line'>rm -rf _deploy
</span><span class='line'>mkdir _deploy
</span><span class='line'>cd _deploy
</span><span class='line'>Initialized empty Git repository in /Users/ryo/Dropbox/octopress/_deploy/.git/
</span><span class='line'>[master (root-commit) 9208c45] Octopress init
</span><span class='line'> 1 file changed, 1 insertion(+)
</span><span class='line'> create mode 100644 index.html
</span><span class='line'>cd -
</span><span class='line'>
</span><span class='line'>---
</span><span class='line'>## Now you can deploy to https://github.com/ryoogata/ryoogata.github.io.git with `rake deploy` ##</span></code></pre></td></tr></table></div></figure>


<h2>octpress Directory 自体 を source ブランチに登録する</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git add .
</span><span class='line'>$ git commit -m "first commit"
</span><span class='line'>$ git push origin source
</span><span class='line'>
</span><span class='line'>Counting objects: 4901, done.
</span><span class='line'>Delta compression using up to 4 threads.
</span><span class='line'>Compressing objects: 100% (2181/2181), done.
</span><span class='line'>Writing objects: 100% (4901/4901), 1.34 MiB | 231.00 KiB/s, done.
</span><span class='line'>Total 4901 (delta 2366), reused 4871 (delta 2338)
</span><span class='line'>To https://github.com/ryoogata/ryoogata.github.io.git
</span><span class='line'> * [new branch]      source -&gt; source</span></code></pre></td></tr></table></div></figure>


<h1>記事の作成</h1>

<h2>記事の準備</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake new_post["vagrant Chef-Server]</span></code></pre></td></tr></table></div></figure>


<p>rake new_post[&lsquo;&rsquo;]の引数として、空白区切りで 最初の単語をcategory、後の単語を全てtagsとして登録する</p>

<h1>Customize</h1>

<h2>記事のパーマリンク変更</h2>

<p>_config.yml</p>

<ul>
<li><p>修正前
permalink: /blog/:year/:month/:day/:title/</p></li>
<li><p>修正後
permalink: /blog/:categories/:title/</p></li>
</ul>


<h2>タグクラウド</h2>

<p><a href="http://rcmdnk.github.io/blog/2013/03/23/octopress/#section-4">Octopress Tips</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd /tmp
</span><span class='line'>$ git clone https://github.com/tokkonopapa/octopress-tagcloud
</span><span class='line'>$ cd octopress-tagcloud/
</span><span class='line'>$ cp tag_cloud.rb ~/Dropbox/ryoogata.github.io/plugins/
</span><span class='line'>$ cp source/_includes/custom/asides/tag_cloud.html ~/Dropbox/octopress/source/_includes/custom/asides/
</span><span class='line'>$ cp source/_includes/custom/asides/category_list.html ~/Dropbox/octopress/source/_includes/custom/asides/</span></code></pre></td></tr></table></div></figure>


<h2>記事の下書き設定</h2>

<p>Rakefile に <code>published: false</code> を追加</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>111   open(filename, 'w') do |post|
</span><span class='line'>112     post.puts "---"
</span><span class='line'>113     post.puts "layout: post"
</span><span class='line'>114     post.puts "title: \"#{title.gsub(/&/,'&amp;')}\""
</span><span class='line'>115     post.puts "date: #{Time.now.strftime('%Y-%m-%d %H:%M:%S %z')}"
</span><span class='line'>116     post.puts "comments: true"
</span><span class='line'>117     post.puts "categories: "
</span><span class='line'>118     post.puts "published: false"
</span><span class='line'>119     post.puts "---"
</span><span class='line'>120   end</span></code></pre></td></tr></table></div></figure>


<h1>Tips</h1>

<h2>rake deploy について</h2>

<ul>
<li>master ブランチ

<ul>
<li>static サイト用コンテンツ</li>
<li>手元の octpress directory で generate したファイルが commit される</li>
</ul>
</li>
<li>source ブランチ

<ul>
<li>octpress 用の記事のソース</li>
</ul>
</li>
</ul>


<p>github には master ブランチのファイルを元にページが作成される</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[This is a sample post]]></title>
    <link href="http://ryoogata.github.io/blog/sample%20post/a-sample-post/"/>
    <updated>2014-04-22T14:40:00+09:00</updated>
    <id>http://ryoogata.github.io/blog/sample%20post/a-sample-post</id>
    <content type="html"><![CDATA[<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>

<!-- More -->


<h2>this is a sample header</h2>

<p>Here&rsquo;s some sample code:</p>

<pre><code>def test
  @answer = 6*9
  if @answer != 42  # this should never happen
    raise "Oh no, not again."
  else
    print "Don't panic."
end
</code></pre>

<p>{:lang=&ldquo;ruby&rdquo;}</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>The footnote <a href="http://www.example.com">content</a>.<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
</feed>
