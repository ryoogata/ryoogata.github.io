<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: nat | YggdrasillNetwork Blog]]></title>
  <link href="http://ryoogata.github.io/blog/categories/nat/atom.xml" rel="self"/>
  <link href="http://ryoogata.github.io/"/>
  <updated>2015-02-20T00:05:19+09:00</updated>
  <id>http://ryoogata.github.io/</id>
  <author>
    <name><![CDATA[Ryo Ogata]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iptables を利用した NAT Router]]></title>
    <link href="http://ryoogata.github.io/2015/02/19/nat/"/>
    <updated>2015-02-19T23:43:56+09:00</updated>
    <id>http://ryoogata.github.io/2015/02/19/nat</id>
    <content type="html"><![CDATA[<h1>NAT 設定追加</h1>

<h2>内部から外部への通信を NAT する設定</h2>

<p>例: 内部 IP アドレスレンジ ( 10.1.0.0/24 ) から外部への通信を NAT する</p>

<pre><code># iptables -t nat -F
# iptables -t nat -A POSTROUTING -s 10.1.0.0/24 -j MASQUERADE
</code></pre>

<h2>外部から内部への通信を NAT する設定</h2>

<pre><code># iptables -t nat -I PREROUTING -d 172.16.1.36 -p tcp -m tcp --dport 1022 -j DNAT --to-destination "10.1.0.10:2442"
# iptables -t nat -I PREROUTING -d 172.16.1.36 -p tcp -m tcp --dport 1122 -j DNAT --to-destination "10.1.0.11:2442"
# iptables -t nat -I PREROUTING -d 172.16.1.36 -p tcp -m tcp --dport 1222 -j DNAT --to-destination "10.1.0.12:2442"
# iptables -t nat -I PREROUTING -d 172.16.1.36 -p tcp -m tcp --dport 1322 -j DNAT --to-destination "10.1.0.13:2442"
# iptables -t nat -I PREROUTING -d 172.16.1.36 -p tcp -m tcp --dport 1422 -j DNAT --to-destination "10.1.0.14:2442"
# iptables -t nat -I PREROUTING -d 172.16.1.36 -p tcp -m tcp --dport 1080 -j DNAT --to-destination "10.1.0.10:80"
</code></pre>

<h1>NAT 設定削除方法</h1>

<h2>1. 行番号確認</h2>

<pre><code># iptables -t nat -L --line-numbers
</code></pre>

<h2>2. 行数を指定して削除</h2>

<pre><code># iptables -t nat -D PREROUTING 3
</code></pre>

<h1>iptable 設定保存</h1>

<pre><code># service iptables save
</code></pre>

<p>/etc/sysconfig/iptables に保存される</p>

<h1>パケットフォワード設定</h1>

<h2>net.ipv4.ip_forward の設定</h2>

<pre><code># sysctl -w net.ipv4.ip_forward=1
</code></pre>

<h2>設定の保存</h2>

<p>/etc/sysctl.conf に下記の記述を追加</p>

<pre><code>net.ipv4.ip_forward=1
</code></pre>

<h1>参照 URL</h1>

<ul>
<li><a href="http://aidemoire.hatenablog.com/entry/2013/10/04/184507">LinuxでNATルータを構成するメモ</a></li>
<li><a href="http://d.hatena.ne.jp/nosa1/20120313/1331618377">ipTablesのルールの削除</a></li>
<li><a href="http://safe-linux.homeip.net/network/Gateway_Server-06.html">IPv4 フォワーディングを有効にするには</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
